metadata:
  name: geekbench-cpu-single
  format: "Lava-Test Test Definition 1.0"
  description: >
    Geekbench 6 CPU single-core only run (single-thread workloads) with live progress,
    per-iteration logs and CSV dumps.
  os:
    - linux
  scope:
    - performance
    - functional

params:
  OUT_DIR: "./logs_Geekbench_Single"
  RUNS: "1"
  HEARTBEAT_SECS: "15"
  CORE_LIST: ""
  SET_PERF_GOV: "1"
  GEEKBENCH_BIN: "geekbench_aarch64"

  NO_UPLOAD: "1"
  UPLOAD: "0"

  # Geekbench internal options
  GB_ITERATIONS: "" # geekbench --iterations (internal)
  WORKLOAD_GAP: "" # ms

  # Export options (optional)
  EXPORT_TEXT_FILE: "" # if set, geekbench will write it too (script will still parse logs)

  EXTRA_ARGS: ""
  STANDALONE: "0"

run:
  steps:
    - REPO_PATH=$PWD
    - cd Runner/suites/Performance/Geekbench/ || exit 0
    - ./run.sh \
       --outdir "$OUT_DIR" \
       --runs "$RUNS" \
       --core-list "${CORE_LIST:-}" \
       --bin "$GEEKBENCH_BIN" \
       --progress-heartbeat "$HEARTBEAT_SECS" \
       $( [ "$SET_PERF_GOV" = "1" ] && true || echo --no-perf-gov ) \
       $( [ "$NO_UPLOAD" = "1" ] && echo --no-upload || true ) \
       $( [ "$UPLOAD" = "1" ] && echo --upload || true ) \
       --cpu \
       --single-core \
       $( [ -n "$GB_ITERATIONS" ] && echo --iterations "$GB_ITERATIONS" || true ) \
       $( [ -n "$WORKLOAD_GAP" ] && echo --workload-gap "$WORKLOAD_GAP" || true ) \
       $( [ -n "$EXPORT_TEXT_FILE" ] && echo --export-text "$EXPORT_TEXT_FILE" || true ) \
       -- ${EXTRA_ARGS:-} \
       || true
    - $REPO_PATH/Runner/utils/send-to-lava.sh Geekbench.res
